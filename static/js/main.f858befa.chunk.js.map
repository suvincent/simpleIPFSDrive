{"version":3,"sources":["getWeb3.js","test/ipfs.js","logo.svg","components/privatekey.js","components/DriveTable.js","components/Header.js","App.js","serviceWorker.js","index.js"],"names":["getWeb3","Promise","resolve","reject","window","addEventListener","a","ethereum","web3","Web3","enable","console","log","provider","providers","HttpProvider","IPFS","require","flag","create","ipfs","file","add","cid","toString","returnContent","get","type","path","content","chunk","push","PrivateKeyForm","props","useState","settype","className","onChange","e","setprivatekey","target","value","onClick","preventDefault","stopPropagation","DriveTable","Getfile","fhash","fname","ftype","download","blob","Blob","link","document","createElement","href","URL","createObjectURL","click","Table","striped","bordered","hover","size","style","width","margin","marginTop","files","map","self","index","key","Button","variant","DecryptFile","Header","Navbar","bg","Brand","alt","src","ReactLogo","height","CryptoJS","privateKeyToPublicKey","App","setstorageValue","setweb3","accounts","setaccount","contract","setcontract","uploadfile","setuploadfile","privatekey","initflag","setinitflag","filelist","setfilelist","alert","pubkey","generateHexString","iv","lib","WordArray","random","EthCrypto","encryptWithPublicKey","encrypted","EncryptFile","encryptedFile","methods","UploadEncrypt","name","enc","Hex","ciphertext","ephemPublicKey","mac","send","from","gas","message","reader","FileReader","onerror","abort","DOMException","onload","AES","encrypt","result","mode","CTR","readAsDataURL","Upload","decryptkeyIndex","ipfsHash","keyArray","call","abcd","decryptWithPrivateKey","rkey","GetfileDecrypt","decrypted","decrypt","Utf8","readAsBinaryString","length","ret","Math","substring","getList","ViewFiles","useEffect","eth","getAccounts","net","getId","networkId","DriveContract","networks","instance","Contract","abi","error","fetchData","then","initList","rel","integrity","crossOrigin","referrerPolicy","Container","fluid","paddingLeft","paddingRight","Row","Col","sm","xs","lg","marginRight","event","marginBottom","Boolean","location","hostname","match","ReactDOM","render","exact","component","getElementById","navigator","serviceWorker","ready","registration","unregister"],"mappings":"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","file":"static/js/main.f858befa.chunk.js","sourcesContent":["import Web3 from \"web3\";\n\nconst getWeb3 = () =>\n  new Promise((resolve, reject) => {\n    // Wait for loading completion to avoid race conditions with web3 injection timing.\n    window.addEventListener(\"load\", async () => {\n      // Modern dapp browsers...\n      if (window.ethereum) {\n        const web3 = new Web3(window.ethereum);\n        try {\n          // Request account access if needed\n          await window.ethereum.enable();\n          // Acccounts now exposed\n          resolve(web3);\n        } catch (error) {\n          reject(error);\n        }\n      }\n      // Legacy dapp browsers...\n      else if (window.web3) {\n        // Use Mist/MetaMask's provider.\n        const web3 = window.web3;\n        console.log(\"Injected web3 detected.\");\n        resolve(web3);\n      }\n      // Fallback to localhost; use dev console port by default...\n      else {\n        const provider = new Web3.providers.HttpProvider(\n          // \"http://127.0.0.1:8545\"// for development\n          \"https://ropsten.infura.io/v3/9f86490b4b644532bfb6e4f26a7ab590\"//for testnet\n        );\n        const web3 = new Web3(provider);\n        console.log(\"No web3 instance injected, using Local web3.\");\n        resolve(web3);\n      }\n    });\n  });\n\nexport default getWeb3;\n","const IPFS = require('ipfs-core')\r\nexport async function init (flag) {\r\n    if(!flag)return\r\n    const ipfs = await IPFS.create()\r\n    console.log(\"initailzing\")\r\n    window[\"ipfs\"] =  ipfs\r\n}\r\n\r\nexport async function testAdd (file,flag) {\r\n    if(!flag)return\r\n    const ipfs = window[\"ipfs\"]\r\n    const { cid } = await ipfs.add(file)\r\n    // console.info(cid)\r\n    // console.log(\"QAQ\")\r\n    return cid.toString()\r\n    // QmXXY5ZxbtuYj6DnfApLiGstzPN7fvSyigrRee3hDWPCaf\r\n}\r\nexport async function testGet(cid,flag){\r\n    if(!flag)return\r\n    const ipfs = window[\"ipfs\"]\r\n    var returnContent = [];\r\n    for await (const file of ipfs.get(cid)) {\r\n    console.log(file.type, file.path)\r\n    if (!file.content) continue;\r\n    const content = []\r\n    for await (const chunk of file.content) {\r\n        content.push(chunk)\r\n    }\r\n    console.log(content)\r\n    // console.log(content.toString())\r\n    returnContent.push(content)\r\n    }\r\n    \r\n    console.log(\"finish\")\r\n    return returnContent\r\n}\r\n\r\n// export {testAdd, testGet};\r\nwindow[\"ipfsadd\"] = testAdd\r\nwindow[\"ipfsget\"] = testGet\r\nwindow[\"INITIPFS\"] = init\r\n// console.log('QAQ')","export default __webpack_public_path__ + \"static/media/logo.927f1d60.svg\";","import React, { Component , useState, useEffect } from \"react\";\r\n\r\nfunction PrivateKeyForm(props){\r\n    const [type,settype] = useState('input')\r\n\r\n    function showHide(e){\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n        if(type === 'input'){\r\n            settype('password')\r\n        }\r\n        else{\r\n            settype('input')\r\n        }\r\n    }\r\n    \r\n    function OnchangeInput(e){\r\n        props.setprivatekey(e.target.value)\r\n        // console.log(props.privatekey)\r\n    }\r\n    \r\n    return(\r\n        <>\r\n        <form className=\"littleform\">\r\n        <label className=\"password\">Private Key\r\n        <input type={type} className=\"password__input\" onChange={OnchangeInput} />\r\n        <span className=\"password__show\" onClick={showHide}>{type === 'input' ? 'Hide' : 'Show'}</span>\r\n        </label>\r\n        </form>\r\n        </>\r\n    )\r\n}\r\n\r\nexport default PrivateKeyForm","import React, { Component , useState, useEffect } from \"react\";\r\nimport {Navbar,Button,Table} from 'react-bootstrap'\r\n\r\nfunction DriveTable(props){\r\n  async function Getfile(fhash,fname,ftype){// without encryption\r\n    let download = await window[\"ipfsget\"](fhash,true)\r\n    console.log(download)\r\n    var blob = new Blob(download[0], {type: ftype});\r\n    var link = document.createElement('a');\r\n    link.href = window.URL.createObjectURL(blob);\r\n    link.download = fname;\r\n    link.click();\r\n  }\r\n    return(\r\n        <Table striped bordered hover size=\"sm\" style = {{width :'85%',margin:\"auto\",marginTop : \"1%\"}}>\r\n          <thead>\r\n            <tr>\r\n              <th>#</th>\r\n              <th>file name</th>\r\n              <th>file type</th>\r\n              <th>file hash</th>\r\n              <th>others</th>\r\n            </tr>\r\n          </thead>\r\n          <tbody >\r\n          {props.files.map((self,index) => <tr key={index}>\r\n              <td width=\"3%\">{index}</td>\r\n              {/* name */}\r\n              <td>{self[1]}</td>\r\n              {/* type */}\r\n              <td>{(self[3])?\"Encrypted\": \"public\"}<br/>{self[2]}</td>\r\n              {/* hash */}\r\n              <td width=\"35%\">{self[0]}</td>\r\n              <td width=\"18%\">\r\n              {(self[3])?\r\n                <>\r\n                <Button variant=\"info\" content='Upload' onClick = {()=>{props.DecryptFile(self[5],self[4],self[0],self[1],self[2])}}>Decrypt it</Button>\r\n                &nbsp; &nbsp;\r\n                <Button variant=\"warning\" content='Upload' onClick = {()=>{Getfile(self[0],self[1],self[2])}}>Get Raw</Button>\r\n                </>\r\n                :\r\n                <Button variant=\"info\" content='Upload' onClick = {()=>{Getfile(self[0],self[1],self[2])}}>Get file</Button>\r\n              }\r\n              </td>\r\n            </tr>)}\r\n          </tbody>\r\n        </Table>\r\n    )\r\n}\r\n\r\nexport default DriveTable","import React from \"react\";\r\nimport {Navbar} from 'react-bootstrap'\r\nimport \"../App.css\";\r\nimport 'bootstrap/dist/css/bootstrap.min.css';\r\nimport ReactLogo from '../logo.svg';\r\n\r\nfunction Header () {\r\n    return (\r\n      <>\r\n      <Navbar bg=\"dark\" variant=\"dark\">\r\n        <Navbar.Brand href=\"/\">\r\n          <img\r\n            alt=\"\"\r\n            src={ReactLogo}\r\n            width=\"30\"\r\n            height=\"30\"\r\n            className=\"d-inline-block align-top\"\r\n          />{' '}\r\n          React Bootstrap\r\n        </Navbar.Brand>\r\n      </Navbar>\r\n      </>\r\n      );\r\n}\r\n\r\n\r\nexport default Header;\r\n","import React, { Component , useState, useEffect ,useCallback} from \"react\";\nimport getWeb3 from \"./getWeb3\";\nimport {Navbar,Button,Form,Container,Row,Col,Grid} from 'react-bootstrap'\nimport \"./App.css\";\nimport 'bootstrap/dist/css/bootstrap.min.css';\nimport testAdd from './test/ipfs'\nimport ReactLogo from './logo.svg';\nimport EthCrypto from 'eth-crypto';\nimport PrivateKeyForm from './components/privatekey'\nimport DriveTable from './components/DriveTable'\nimport DriveContract from \"./contracts/Drive.json\";\nimport Header from './components/Header'\n// import CryptoJS from \"cryptojs\"\nconst CryptoJS = require(\"crypto-js\")\nconst privateKeyToPublicKey = require('ethereum-private-key-to-public-key')\nfunction App (props) {\n  const [storageValue ,setstorageValue] = useState(0)\n  const [web3,setweb3] = useState(null)\n  const [accounts,setaccount] = useState(null)\n  const [contract,setcontract] = useState(null)\n  const [uploadfile,setuploadfile] = useState(null)\n  const [privatekey,setprivatekey] = useState(null)\n  const [initflag,setinitflag] = useState(false);\n  const [filelist,setfilelist] = useState([])\n  const [dekey,setdekey] = useState(null)\n  const [deiv,setdeiv] = useState(null)\n\n\n  useEffect(()=>{\n    async function fetchData(){\n      try {\n        // Get network provider and web3 instance.\n        const web3 = await getWeb3();\n        if(!window.ipfs)await window[\"INITIPFS\"](true)\n        setweb3(web3)\n        // Use web3 to get the user's accounts.\n        const accounts = await web3.eth.getAccounts();\n        // Get the contract instance.\n        const networkId = await web3.eth.net.getId();\n        console.log(networkId)\n        const deployedNetwork = DriveContract.networks[networkId];\n        const instance = new web3.eth.Contract(\n          DriveContract.abi,\n          // deployedNetwork && deployedNetwork.address,\n          \"0x4CF247a90956185559EE5fb2A9A7E8dDd8A8E985\"\n        );// 0x4CF247a90956185559EE5fb2A9A7E8dDd8A8E985 Drive address\n        setaccount(accounts)\n        setcontract(instance)\n      } catch (error) {\n        // Catch any errors for any of the above operations.\n        alert(\n          `Failed to load web3, accounts, or contract. Check console for details.`,\n        );\n        console.error(error);\n      }\n    }\n\n    // fetchData().then(runExample())\n    fetchData().then(initList())\n  });\n// function OK\n  function captureFile (event) {\n    event.stopPropagation()\n    event.preventDefault()\n  \n    setuploadfile(event.target.files[0])\n    // console.log(CryptoJS)\n  }\n// function OK\n  async function UploadtoChainEncrypted(){\n    // check if there is private key\n    if(!privatekey){// 55e0681bdac2a1b4751da654d5fd043afe847448fbb42ffa5517c752b8eecd35\n      alert('please enter your private key first')\n      return;\n    }\n    // private key turn public key\n    try{\n      let pubkey = privateKeyToPublicKey(privatekey).toString('hex')\n      // gen key ,iv\n      var key = generateHexString(58);\n      console.log(\"key\",key)\n      var iv = CryptoJS.lib.WordArray.random(128/8);\n\n    // encrypt key\n    \n      const encrypted = await EthCrypto.encryptWithPublicKey(\n        pubkey, // publicKey\n        key // message\n      )\n      // encrypt file\n      let encryptedFile =await  EncryptFile(key);\n      console.log(encryptedFile)\n      // send to ipfs\n      let cid =await window[\"ipfsadd\"](encryptedFile,true)\n      // send to chain\n      await contract.methods.UploadEncrypt(\n                cid.toString(),uploadfile.name,uploadfile.type,iv.toString(CryptoJS.enc.Hex),\n                encrypted.ciphertext,encrypted.ephemPublicKey,encrypted.iv,encrypted.mac\n            ).send({ from: accounts[0],gas:4500000 });\n    }\n    catch(err){\n      console.log(err.message)\n      alert(err.message)\n    }\n  }\n// function OK\n  async function EncryptFile(key,iv){\n    var file = uploadfile;\n    var reader = new FileReader();\n    var encryptedFile\n    return new Promise((resolve, reject) => {\n      reader.onerror = () => {\n        reader.abort();\n        reject(new DOMException(\"Problem parsing input file.\"));\n      };\n  \n      reader.onload =  function (e) {\n        var encrypted = CryptoJS.AES.encrypt(e.target.result, key, { iv: iv, \n            mode: CryptoJS.mode.CTR, \n        });\n      // Read file callback!\n        encryptedFile = new Blob([encrypted], {type: file.type});\n        console.log('encryptedFile finish',encryptedFile);\n        resolve(encryptedFile)\n        // setuploadfile(encryptedFile)\n      }\n      reader.readAsDataURL(file);\n    });\n  }\n// for testing not use now\n  async function UploadtoChainEncryptedfortest(){\n    var key = generateHexString(58);\n    setdekey(key)\n    var salt = CryptoJS.lib.WordArray.random(128/8);\n\t  var iv = CryptoJS.lib.WordArray.random(128/8);\n    setdeiv(iv)\n    var file = uploadfile;\n    var reader = new FileReader();\n    console.log(key,iv)\n      // Read file callback!\n    reader.onload =  function (e) {\n      \n        var encrypted = CryptoJS.AES.encrypt(e.target.result, key, { iv: iv, \n            mode: CryptoJS.mode.CTR, \n            // padding: CryptoJS.pad.Pkcs7 \n        });\n        console.log(encrypted.ciphertext)\n        var encryptedFile = new Blob([encrypted], {type: file.type});\n        setcontract(e.target.result)\n        let decrypted =  CryptoJS.AES.decrypt(encrypted, key, { iv: iv, \n        // let decrypted =  CryptoJS.AES.decrypt(encryptedFile, key, { iv: iv, \n            mode: CryptoJS.mode.CTR, \n            // padding: CryptoJS.pad.Pkcs7 \n        }).toString(CryptoJS.enc.Utf8);\n        console.log(decrypted)\n        console.log(_base64ToArrayBuffer(e.target.result.split(',')[1]))\n        // if(e.target.result == decrypted){\n        //     console.log(\"same\")\n        // }\n        // if(\"data:application/pdf;base64,\"+btoa(String.fromCharCode(...new Uint8Array(_base64ToArrayBuffer(e.target.result.split(',')[1])))) == e.target.result){\n        //   console.log(\"same using array buffer\")\n        // }\n        // data:application/pdf;base64,\n        // var decryptedFile = new File([decrypted], \"test\", {type: \"application/pdf\"});\n        // console.log('decryptedFile', decryptedFile);\n        // var link = document.createElement('a');\n        // link.href = decrypted;\n        // var fileName = \"reportName\";\n        // link.download = fileName;\n        // link.click();\n        console.log('encryptedFile', encryptedFile.size);\n        setuploadfile(encryptedFile)\n    }\n    reader.readAsDataURL(file);\n  }\n// function OK\n  async function UploadtoChain(){// without encryption'\n    \n      if(uploadfile && contract){\n          console.log(uploadfile.name)\n          console.log(contract )\n          \n          let cid =await window[\"ipfsadd\"](uploadfile,true)\n          console.log(cid.toString())\n          setstorageValue(cid.toString())\n          try{\n            console.log(cid.toString(),uploadfile.name,uploadfile.type)\n          await contract.methods.Upload(cid.toString(),uploadfile.name,uploadfile.type)\n                .send({ from: accounts[0],gas:4500000 });\n          }\n          catch(err){\n            console.log(err.message)\n          }\n          // test decrypt\n          // await GetfileDecrypt(dekey,deiv,cid.toString())\n      }\n      else{\n          console.log('no file selected')\n          alert('no file selected')\n      }\n  }\n// function OK\n  async function DecryptFile(decryptkeyIndex, iv, ipfsHash ,fname,ftype){\n    // check if there is private key\n    if(!privatekey){// \n      alert('please enter your private key first')\n      return;\n    }\n    let abcd = await contract.methods.keyArray(decryptkeyIndex).call()\n    console.log(abcd)\n    // DecryptFileKey\n    const rkey = await EthCrypto.decryptWithPrivateKey(\n      privatekey, // privateKey\n      {\n        ciphertext:abcd[0],\n        ephemPublicKey:abcd[1],\n        iv:abcd[2],\n        mac:abcd[3]\n      }\n    );\n    console.log(rkey)\n    await GetfileDecrypt(rkey, iv, ipfsHash, fname,ftype)\n  }\n// function OK\n  async function GetfileDecrypt(key, iv, ipfsHash, fname,ftype){//  encryption\n    console.log(ipfsHash)\n    let download = await window[\"ipfsget\"](ipfsHash,true)\n    var blob = new Blob(download[0], {type: ftype});\n    \n    var reader = new FileReader();\n    reader.onload = () => {\n        var decrypted = CryptoJS.AES.decrypt(reader.result, key, { iv: iv, \n        mode: CryptoJS.mode.CTR, \n        }).toString(CryptoJS.enc.Utf8);\n        const a = document.createElement(\"a\");\n        a.href = decrypted;\n        a.download = fname;\n        a.click();\n    };\n    reader.readAsBinaryString(blob);\n    \n  }\n// function OK\n  async function Getfile(){// without encryption\n    console.log(storageValue)\n    let download = await window[\"ipfsget\"](storageValue,true)\n    console.log(download)\n    var blob = new Blob(download[0], {type: \"application/pdf\"});\n    var link = document.createElement('a');\n    link.href = window.URL.createObjectURL(blob);\n    var fileName = \"reportName\";\n    link.download = fileName;\n    link.click();\n  }\n// for testing \n  async function testencryptbypublickey(){\n    let pubkey = privateKeyToPublicKey(privatekey).toString('hex')\n    let k = generateHexString(58)\n    console.log(k)\n    const encrypted = await EthCrypto.encryptWithPublicKey(\n      pubkey, // publicKey\n      k // message\n    )\n    console.log(encrypted)\n    const message = await EthCrypto.decryptWithPrivateKey(\n      privatekey, // privateKey\n      encrypted\n    );\n    console.log(message)\n  }\n// function OK\n  function generateHexString(length) {\n    var ret = \"\";\n    while (ret.length < length) {\n      ret += Math.random().toString(16).substring(2);\n    }\n    return ret.substring(0,length);\n  }\n// for testing \n  function _base64ToArrayBuffer(base64) {\n    var binary_string = window.atob(base64);\n    var len = binary_string.length;\n    var bytes = new Uint8Array(len);\n    for (var i = 0; i < len; i++) {\n        bytes[i] = binary_string.charCodeAt(i);\n    }\n    return bytes.buffer;\n  }\n// for log in // for testing \n  async function runExample  (){\n    // const { web3,accounts } = this.state;\n    console.log(\"trigger\")\n    if(initflag)return\n    if(!web3)return\n    if(!accounts)return\n    setinitflag(true)\n    let nonce = Math.floor(Math.random() * 1000000)\n    // let location = useLocation();\n    web3.eth.personal.sign(web3.utils.fromUtf8(`I am signing my one-time nonce: ${nonce}`), accounts[0], (err,sig)=>{\n      // console.log(sig)\n      web3.eth.personal.ecRecover(`I am signing my one-time nonce: ${nonce}`,sig)\n      .then((pubKey)=>{\n        console.log(pubKey)\n        if(pubKey === accounts[0].toLowerCase()){\n           console.log('pass')\n          //  history.push('/Upload')\n          \n        }\n      })\n      \n    });\n\n   \n  };\n\n  async function initList(){\n    if(initflag)return\n    await getList()\n  }\n\n  async function getList(){\n    if(!contract)return\n     let file =  await contract.methods.ViewFiles().call()\n     console.log(file)\n     setfilelist(file)\n     setinitflag(true)\n\n  }\n\n  if (!web3) {\n    return <div>Loading Web3, accounts, and contract...</div>;\n  }\n    return (\n      <>\n      <link rel=\"stylesheet\" href=\"https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css\" integrity=\"sha512-iBBXm8fW90+nuLcSKlbmrPcLa0OT92xO1BIsZ+ywDWZCvqsWgccV3gFoRBv0z+8dLJgyAHIhR35VZc2oM/gI1w==\" crossOrigin=\"anonymous\" referrerPolicy=\"no-referrer\" />\n      <Container fluid style={{ paddingLeft: 0, paddingRight: 0 }}>\n        <Header></Header>\n        <Row>\n          <Col sm={9}>\n          <div className=\"App\">\n            <br/>\n                  <h2>IPFS drive</h2>\n            <br/>\n            <h4>refresh file</h4>\n            <Button variant=\"secondary\" content='Upload' onClick = {getList}><i className=\"fas fa-sync\"></i></Button> \n            <DriveTable files={filelist} DecryptFile={DecryptFile} />\n          </div>\n          </Col>\n          <Col xs lg=\"2\">\n            <PrivateKeyForm privatekey={privatekey} setprivatekey={setprivatekey} style={{ marginRight: 4 }}/>\n            <form className=\"Uploadform\">\n              <Container>\n                  <Row>\n                    <Col>\n                    <label className=\"password\"> &nbsp;&nbsp;&nbsp;upload&nbsp;&nbsp;</label>\n                    <a className=\"middle\"><Button variant=\"secondary\" content='Upload' onClick = {UploadtoChain}>Upload &nbsp;&nbsp;&nbsp;&nbsp;file&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</Button></a>\n                    </Col>\n                    <Col xs={7}>\n                    <label className=\"password\">Encrypt upload</label>\n                    <a><Button variant=\"dark\" content='Upload' onClick = {UploadtoChainEncrypted}>Upload file Encrypt</Button></a>\n                    </Col>\n                  </Row>\n              </Container>\n            </form>\n            <form className=\"Uploadform\">\n              <label className=\"password\">Upload file</label>\n              <input type=\"file\" onChange={captureFile} style={{ marginBottom: 4 }}/>\n            </form>\n          </Col>\n        </Row>\n      </Container>\n      \n      \n      </>\n      );\n}\n\nexport default App;\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.1/8 is considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\nexport function register(config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl, config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl, config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl)\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready.then(registration => {\n      registration.unregister();\n    });\n  }\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport * as serviceWorker from './serviceWorker';\nimport {\n    BrowserRouter as Router,\n    Switch,\n    Route,\n    Link\n  } from \"react-router-dom\";\nReactDOM.render(\n  <Router>\n          <Route exact path=\"/\" component = {App}/> \n          {/* <Route path=\"/Upload\" component = {Upload} /> */}\n  </Router>, document.getElementById('root'));\n{/* <App/>, document.getElementById('root')); */}\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister();\n"],"sourceRoot":""}